<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta property="qc:admins" content="77103107776157736375"/>
    <meta property="wb:webmaster" content="c4f857219bfae3cb"/>
    <meta http-equiv="Access-Control-Allow-Origin" content="*"/>
    <meta http-equiv="Cache-Control" content="no-transform "/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="icon" href="static2/images/logo-icon.png">
    <link rel="stylesheet" href="static2/css/moco.min.css" type="text/css"/>
    <link rel="stylesheet" href="static2/css/swiper-3.4.2.min.css">
    <link rel="stylesheet" href="static2/css/common.css">
    <link rel="stylesheet" href="static2/css/header.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="static2/css/0938fa5423c94e9f9c9af663e26b4c3d.css" type="text/css"/>
    <style type="text/css">
        .chapter-ul ul li {
            padding: 12px 0;
            border-top: 1px solid rgba(28, 31, 33, .1);
            line-height: 24px;
        }

        .chapter-ul ul li .watch-free {
            float: right;
            padding: 0 16px;
            font-size: 12px;
            background: rgba(242, 13, 13, .1);
            border-radius: 12px;
            color: #f20d0d;
            font-weight: 700;
        }

        .chapter-ul ul li .watch-free:hover {
            background: red;
            color: #fff;
            cursor: pointer;
        }

        .card-sets:hover {
            cursor: pointer;
        }

        .user-card-box:hover {
            cursor: pointer;
        }

        .bottom-box {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
        }

    </style>
    <link merge="false" rel="stylesheet" type='text/css' href="static2/css/203-less.css"/>
    <link rel="stylesheet" href="static2/css/d53ac9fdc5de492c92bc1a710c7deea8.css" type="text/css"/>
</head>

<body>
<div style="position: relative;width: 100%;">
    <!--顶部导航栏-->
    <div id="header">
        <div class="page-container clearfix" id="nav" style="background-color: #fff !important;">
            <div id="logo" class="logo">
                <a href="index2.html" title="首页">
                    <img style="height: 48px;margin-top: 12px" title="白又白" src="static2/images/logo.png">
                </a>
            </div>
            <button type="button" class="navbar-toggle visible-xs-block js-show-menu">
                <i class="icon-menu"></i>
            </button>
            <div id="login-area">
                <ul class="header-unlogin clearfix">
                    <li class="app-download  user-card-box" id="js-app-load">
                        <a target="_blank" style="width:60px;">关注公众号</a>
                        <div class="g-user-card">
                            <img src="static2/images/code.jpg">
                        </div>
                    </li>
                    <li class="header-signin" id="login">
                        <a href="login.html" id="js-signin-btn">登录</a>

                    </li>
                    <li class="set_btn user-card-box" id="header-user-card" style="display: none;">
                        <a id="header-avator" class="user-card-item js-header-avator" action-type="my_menu"
                           target="_self">
                            <img style="width: 40px;height: 40px" width="40" height="40" id="headerImg"
                                 src="//img3.mukewang.com/582c2f900001f84406400640-100-100.jpg">
                            <i class="myspace_remind" style="display: none;"></i>
                            <span style="display: none;">动态提醒</span>
                        </a>
                        <div class="g-user-card">
                            <div class="card-inner">
                                <div class="card-top clearfix">
                                    <a class="l"><img
                                            src="//img3.mukewang.com/582c2f900001f84406400640-100-100.jpg"
                                            alt="qq__49544366693" id="Imgsrc">
                                    </a>
                                    <div class="card-top-right-box l">
                                        <div>
                                            <span class="name text-ellipsis" id="uName">byb_49544366693</span>
                                        </div>
                                        <div class="meta">
                                            <span>积分<b id="js-user-credit">0</b></span>
                                            <span><b id="js-user-mp">普通会员</b></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="user-center-box">
                                    <ul class="clearfix">
                                        <li class="l">
                                            <a href="myProduct.html">
                                                <span class="user-center-icon icon-tick">我的课程</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>

                                <div class="card-sets clearfix">
                                    <a class="l" onclick="edit();">安全退出</a>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!--视频播放-->
    <div style="position: relative;margin-bottom:100px;display: flex;flex-direction: row;justify-content: center;margin-top: 60px">
        <video width="1200" id="sound" controls="controls" controlsList='nodownload noremote footbar'
               oncontextmenu="return false;" autoplay></video>
    </div>

    <!--底部导航栏-->
    <div class="infolayout clearfix bottom-box">
        <div class="appendtemplate">
            <!--ES_BEGIN-->
            <div class="introduce-content">

                <div id="footer">
                    <div class="waper">
                        <div class="footerwaper clearfix">
                            <div class="footer_intro l">
                                <div class="footer_link">
                                    <ul>
                                        <li>
                                            <a target="_blank">网站首页</a>
                                        </li>
                                        <li>
                                            <a target="_blank">联系我们</a>
                                        </li>
                                        <li>
                                            <a target="_blank">帮助中心</a>
                                        </li>
                                        <li>
                                            <a target="_blank">意见反馈</a>
                                        </li>
                                        <li>
                                            <a target="_blank">友情链接</a>
                                        </li>
                                        <!-- <li><a href="http://www.imooc.com/about/us" target="_blank">关于我们</a></li> -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 模态框（Modal） -->
                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;
                                </button>
                                <h4 class="modal-title" id="myModalLabel">公众号二维码</h4>
                            </div>
                            <div class="modal-body" style="text-align: center;">
                                <div>请扫描下方的二维码进行购买</div>
                                <img src="static2/images/code.jpg">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 静态储存区,全局变量 -->
<script src="static2/js/extern.js"></script>
<script src="static2/js/ssologin.js"></script>
<script type="text/javascript" src="static2/js/jquery-1.9.1.min.js"></script>
<!--<script type="text/javascript" src="static2/js/jquery.cookie.js"></script>-->
<script src="static2/js/bootstrap.min.js"></script>
<script type="text/javascript">
    // 获取个人信息
    $.ajax({
        type: "post",
        url: ctx + "/ssm/front/getUserByIdPC",
        data: {
            uId: uId,
            token: getToken()
        },
        success: function (d) {
            d = JSON.parse(d)
            if (d.data.length < 1){
                window.location.href = "login.html";
            }
            if (d.status == 204) {
                window.location.href = "login.html";
            } else {
                $("#header-user-card").css("display", "block");
                $("#login").css("display", "none");
                $("#headerImg").attr("src", d.data[0].uImg);
                $("#Imgsrc").attr("src", d.data[0].uImg);
                $("#uName").text(d.data[0].uName)
                $("#js-user-credit").text(d.data[0].uIntegral)
                $("#js-user-mp").text(d.data[0].levelName)
            }
        },
        error: function (error) {
            window.location.href = "login.html";
        }
    })

    $(document).ready(function () {
        // //创建XMLHttpRequest对象
        // var xhr = new XMLHttpRequest();
        // //配置请求方式、请求地址以及是否同步
        // xhr.open('POST', ctx+'/ssm/front/getVideoSrc?fileName2=123.mp4', true);
        // //设置请求结果类型为blob
        // xhr.responseType = 'blob';
        // //请求成功回调函数
        // xhr.onload = function(e) {
        //     if (this.status == 200) {//请求成功
        //         //获取blob对象
        //         var blob = this.response;
        //         //获取blob对象地址，并把值赋给容器
        //         $("#sound").attr("src", URL.createObjectURL(blob));
        //     }
        // };
        // xhr.send();

        // alert(getQueryString('goodsName'))

        var eleAppend = document.getElementById("forAppend");
        window.URL = window.URL || window.webkitURL;
        // if (typeof history.pushState == "function") {
        var xhr = new XMLHttpRequest();
        xhr.open("get", ctx + "/ssm/front/player2pc?pId=" + getQueryString('pId') + "&uId=" + uId + "&fileName2=" + getQueryString('goodsName') + "&token=" + token, true);
        xhr.responseType = "blob";
        xhr.onload = function () {
            // console.log('---1111---------------------------------------------------')
            // console.log('---1111---------------------------------------------------')
            // console.log('---1111---------------------------------------------------')
            // console.log(this)
           if (this.status == 200) {
                var blob = this.response;
                // console.log('---------------------------------------------------------------')
                // console.log('---------------------------------------------------------------')
                // console.log('---------------------------------------------------------------')
                // console.log(blob)
                // console.log('---------------------------------------------------------------')
                // console.log('---------------------------------------------------------------')
                // var img = document.createElement("img");
                // img.onload = function (e) {
                //     window.URL.revokeObjectURL(img.src); // 清除释放
                // };
                // img.src = window.URL.createObjectURL(blob);
                // console.log(img.src)
                $("#sound").attr("src", window.URL.createObjectURL(blob));
                // console.log(document.getElementById('sound').offsetHeight)
                // document.getElementById('menu').style.height = document.getElementById('sound').offsetHeight + 'px'
                eleAppend.appendChild(img);
            } else if (this.status == 204) {
                window.location.href = "login.html";
            } else if (this.status == 404) {
                // window.location.href = "login.html";
                alert('请在手机端购买')
            }
        }
        xhr.send();



        // 普通MP4视频
        // pc端player2pc视频播放
        /* $.ajax({
            type: "get",
             // url: ctx + "/ssm/front/getVideoSrc?fileName2=123.mp4",
            // url: ctx + "/ssm/front/player2pc?pId="+getQueryString("pId")+"&uId="+uId+"&fileName2=" + getQueryString('goodsName'),
             url: ctx + "/ssm/front/player2pc?pId=" + getQueryString('pId') + "&uId=" + uId + "&fileName2=" + getQueryString('goodsName')+"&token="+token,
             success: function (res) {
                 console.log('---1111blob-----------------------------------------------')
                // console.log(res)
                const objectURL = window.URL.createObjectURL(res);
                console.log('---2222blob-----------------------------------------------')
                console.log(objectURL)
                $("#sound").attr("src", res);
             }
        });*/

        $.ajax({
            type: "get",
            url: ctx + "/ssm/front/getProductByPid?pId=" + getQueryString("pId") + "&uId=" + uId,
            success: function (d) {
                console.log('---getUserById-----------------------------------------------')
                // console.log(d)
                var d = JSON.parse(d)

                // console.log(d.data.pIsgroup)
                // 将商品名称转化成数组的形式，并除去为空的item
                var goodsNameList = d.data.pIsgroup.split(',');
                var newGoodsNameList = []
                // console.log(goodsNameList)
                for (var p = 0; p < goodsNameList.length; p++) {
                    // console.log(goodsNameList[p])
                    if (goodsNameList[p]) {
                        newGoodsNameList.push(goodsNameList[p])
                    }
                }

                // pValidity 0是video,1是ppt，2是pdf,3是实物商品
                for (var pro = 0; pro < newGoodsNameList.length; pro++) {
                    if (d.data.pValidity === 0) {
                        $("#pptItem").append(
                            `<a href=""></a><div id="playview${pro}"
                            style="margin: 6px;display: flex;flex-direction: row;justify-content: center;align-items: center">
                                <img width="40" height="40" src="static2/images/play.png">
                                <span style="color: white;margin-left: 6px;text-decoration:underline ">${d.data.pName}</span>
                                </div>`
                        )
                    } else if (d.data.pValidity === 1 || d.data.pValidity === 2) {
                        $("#pptItem").append(
                            `<div id="pptItem1"
                            style="margin: 6px;display: flex;flex-direction: row;justify-content: center;align-items: center">
                                <img width="40" height="40" src="static2/images/ppt.png">
                                <span style="color: white;margin-left: 6px;text-decoration:underline ">${d.data.pName}</span>
                                </div>`
                        )
                    } else if (d.data.pValidity === 3) {
                        $("#pptItem").append(
                            `<div id="pptItem1"
                            style="margin: 6px;display: flex;flex-direction: row;justify-content: center;align-items: center">
                                <img width="40" height="40" src="static2/images/logo-icon.png">
                                <span style="color: white;margin-left: 6px;text-decoration:underline ">${d.data.pName}</span>
                                </div>`
                        )
                    }
                }

                // console.log('---getUserById-----------------------------------------------')

                $("title").text(d.data.pName)
                // $("#pic").attr("src",ctx+"/ssm/file/showPic?fileName="+d.data.teacher.tPic+"&uId=124");
                $("#pic").attr("src", d.data.teacher.tPic + "&uId=124");
                $("#nickname").text(d.data.teacher.tName)
                var productItems = d.data.productItems;
                $("#pname").append(`<h1>${d.data.pName}</h1>`)
                $(".info-desc").html(d.data.teacher.tPosition)


                $("#productprice").append(
                    // <!-- 只在未购买和已购买正常转状态显示 --> <!-- 没有任何活动 -->
                    `<div class="con">
                        <div class="time-price clearfix">
                            <div class="no-discount clearfix l">
                                <div class="ori-price l">￥${d.data.pPrice}</div>
                            </div>
                        </div>
                        <div class='info-bar clearfix' style="margin-top: 2px">
                            <span>学习人数</span>
                            <span class="nodistance">${d.data.pNum}</span>
                            <i class="imv2-dot_samll"></i>
                            <span>综合评分</span>
                            <span class="nodistance">9.98分</span>
                        </div>
                        <div class="btns">
                            <a href="javascript:;" class="js-buy-trigger red-btn gobuy" data-cid="203" data-pay="0"
                                id="buy-trigger" data-toggle="modal" data-target="#myModal">立即购买</a>
                        </div>
                    </div>`
                )
                for (var i = 0; i < productItems.length; i++) {
                    $("#productItems").append(
                        `<li>
                             <i class="imv2-video"></i>
                             <span class="title_info js-watchTrigger">${productItems[i].iName}</span>
                             <span class="watch-free js-watchForFree" data-index="0"  onclick=player("${productItems[i].iPic}");>播放</span>
                             <input type="hidden" value="22787">
                        </li>`
                    )
                }
            }
        })
    })

    function player(iPic) {
        $.ajax({
            type: "post",
            url: ctx + "/ssm/front/player",
            async: true,
            data: {"fileName": iPic, "uId": uId},
            success: function (d) {
                console.log(d)
                var d = JSON.parse(d)
                if (d.status == 204) {
                    alert(d.msg)
                } else if (d.status == 206) {
                    alert(d.msg)
                }
                else {
                    $("#video-wrap").css("display", "block")
                    $("#play").attr("src", d.data.result);
                }
            }
        });
        /* $("#play").attr("src",ctx+"/ssm/front/player?fileName="+iPic+"&uId="+uId);
         $("#video-wrap").css("display", "block")*/
    }

    $(".set_btn").hover(function () {
        $(this).addClass("set_btn user-card-box hover");
        $(this).siblings().removeClass('hover');

    }, function () {
        $(this).removeClass('hover');
    });

    $("#js-app-load").hover(function () {

        $(this).addClass("user-card-box hover");
        $(this).siblings().removeClass('hover');

    }, function () {
        $(this).removeClass('hover');
    });

    $("#buy-trigger").click(function () {

    })
</script>

</body>
</html>